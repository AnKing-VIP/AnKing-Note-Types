<!-- Shortcut Matcher Function -->
<script>
  var specialCharCodes = {
    "-": "minus",
    "=": "equal",
    "[": "bracketleft",
    "]": "bracketright",
    ";": "semicolon",
    "'": "quote",
    "`": "backquote",
    "\\": "backslash",
    ",": "comma",
    ".": "period",
    "/": "slash",
  };
  // Returns function that match keyboard event to see if it matches given shortcut.
  function shortcutMatcher(shortcut) {
    let shortcutKeys = shortcut.toLowerCase().split(/[+]/).map(key => key.trim())
    let mainKey = shortcutKeys[shortcutKeys.length - 1]
    const mainKeyVariants = [];
    if (mainKey.length === 1) {
      if (/\d/.test(mainKey)) {
        // Treat alphanumeric and numpad keys interchangeably
        mainKeyVariants.push("digit" + mainKey)
        mainKeyVariants.push("numpad" + mainKey)
      } else if (/[a-zA-Z]/.test(mainKey)) {
        mainKeyVariants.push("key" + mainKey)
      } else {
        let code = specialCharCodes[mainKey];
        if (code) {
          mainKey = code
          mainKeyVariants.push(code)
        } else {
          mainKeyVariants.push(mainKey)
        }
      }
    } else {
      mainKeyVariants.push(mainKey)
    }
    let ctrl = shortcutKeys.includes("ctrl")
    let shift = shortcutKeys.includes("shift")
    let alt = shortcutKeys.includes("alt")

    let matchShortcut = function (ctrl, shift, alt, mainKeyVariants, event) {
      if (!mainKeyVariants.includes(event.code.toLowerCase())) return false
      if (ctrl !== (event.ctrlKey || event.metaKey)) return false
      if (shift !== event.shiftKey) return false
      if (alt !== event.altKey) return false
      return true
    }.bind(window, ctrl, shift, alt, mainKeyVariants)
    
    return matchShortcut
  }
</script>